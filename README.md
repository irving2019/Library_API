# Library Management System API

REST API система управления библиотекой с использованием FastAPI и SQLAlchemy.

## Функциональность

- Аутентификация пользователей (библиотекарей) с JWT
- Управление книгами (CRUD операции)
- Управление читателями (CRUD операции)
- Система выдачи и возврата книг
- Отслеживание количества книг и их доступности

## Запуск проекта

### С использованием Docker

1. Убедитесь, что у вас установлен Docker и Docker Compose
2. Клонируйте репозиторий
3. В корневой директории выполните:
```bash
docker-compose up --build
```

### Локальный запуск

1. Создайте виртуальное окружение:
```bash
python -m venv .venv
.\.venv\Scripts\Activate.ps1  # для Windows
source .venv/bin/activate     # для Linux/Mac
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте файл .env с настройками:
```env
DATABASE_URL=sqlite:///library.db
SECRET_KEY=your-secret-key-here
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
```

4. Примените миграции:
```bash
alembic upgrade head
```

5. Запустите сервер:
```bash
uvicorn main:app --reload
```

## Структура базы данных

### Таблицы:
- users: Данные библиотекарей (email, хешированный пароль)
- books: Информация о книгах (название, автор, ISBN, количество копий)
- readers: Данные читателей (имя, email)
- borrowed_books: Записи о выдаче/возврате книг

## Реализация бизнес-логики

### 4.1 Проверка доступности книги
- При выдаче проверяется наличие свободных экземпляров (copies_available > 0)
- После выдачи количество уменьшается на 1
- При возврате количество увеличивается на 1

### 4.2 Ограничение на количество книг у читателя
- Перед выдачей проверяется количество книг у читателя
- Максимальное количество книг на руках - 3
- Учитываются только невозвращенные книги

### 4.3 Контроль возврата книг
- Проверяется, была ли книга выдана данному читателю
- Нельзя вернуть уже возвращенную книгу
- При возврате фиксируется дата возврата

## Аутентификация

- Используется JWT (JSON Web Tokens)
- Пароли хешируются с помощью bcrypt
- Токены имеют ограниченное время жизни (30 минут)
- Все операции кроме просмотра списка книг требуют аутентификации

### Библиотеки для аутентификации:
- python-jose: Создание и проверка JWT токенов
- passlib[bcrypt]: Безопасное хеширование паролей
- python-multipart: Обработка form-data для логина

## API Endpoints

### Аутентификация
- POST /register - Регистрация нового библиотекаря
- POST /token - Получение JWT токена

### Книги
- GET /books - Список всех книг
- POST /books - Добавление новой книги
- GET /books/{id} - Детали книги
- PUT /books/{id} - Обновление книги
- DELETE /books/{id} - Удаление книги

### Читатели
- GET /readers - Список читателей
- POST /readers - Добавление читателя
- GET /readers/{id} - Детали читателя
- PUT /readers/{id} - Обновление данных читателя
- DELETE /readers/{id} - Удаление читателя

### Выдача/возврат книг
- POST /borrow - Выдача книги
- POST /return/{borrow_id} - Возврат книги
- GET /borrowed-books/reader/{reader_id} - Книги на руках у читателя

## Дополнительная функциональность

Предлагается добавить систему уведомлений о просрочке возврата книг:
- Добавление поля expected_return_date в таблицу borrowed_books
- Периодическая проверка просроченных книг
- Автоматическая отправка email-уведомлений читателям
- API эндпоинт для просмотра просроченных книг
